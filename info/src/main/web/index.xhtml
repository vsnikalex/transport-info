<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:composite="http://xmlns.jcp.org/jsf/composite"
        template="/WEB-INF/templates/default.xhtml">
   <ui:define name="drivers">
      <script type="text/javascript" src="resources/js/sse.js"></script>
      <script>
         EventSource = SSE;

         const source = new SSE("http://localhost:8080/info/rest/cdievents");

         source.addEventListener('drivers stat', function(e) {
            let ds = JSON.parse(e.data);

            document.getElementById('ds_available').innerHTML = ds.available;
            document.getElementById('ds_driving').innerHTML = ds.driving;
            document.getElementById('ds_others').innerHTML = ds.others;
            document.getElementById('ds_total').innerHTML = ds.total;
         });

         source.addEventListener('trucks stat', function(e) {
            let ts = JSON.parse(e.data);

            document.getElementById('ts_available').innerHTML = ts.available;
            document.getElementById('ts_inUse').innerHTML = ts.inUse;
            document.getElementById('ts_defective').innerHTML = ts.defective;
            document.getElementById('ts_total').innerHTML = ts.total;
         });

         source.stream();
      </script>
      <div class="tc-note tc-note-info">
         <table class="table">
            <thead>
            <tr>
               <th>Drivers</th>
               <th><span class="sr-only">Preis Spalte</span></th>
            </tr>
            </thead>
            <tbody>
            <tr>
               <td>Available</td>
               <td id="ds_available" class="numeric"></td>
            </tr>
            <tr>
               <td>Driving</td>
               <td id="ds_driving" class="numeric"></td>
            </tr>
            <tr>
               <td>Other work</td>
               <td id="ds_others" class="numeric"></td>
            </tr>
            </tbody>
            <tfoot>
            <tr>
               <td colspan="4" class="numeric text-brand text-semibold">
                  Total: <span id="ds_total"></span>
               </td>
            </tr>
            </tfoot>
         </table>
      </div>
   </ui:define>
   <ui:define name="trucks">
      <div class="tc-note tc-note-info">
         <table class="table">
            <thead>
            <tr>
               <th>Trucks</th>
               <th><span class="sr-only">Preis Spalte</span></th>
            </tr>
            </thead>
            <tbody>
            <tr>
               <td>Available</td>
               <td id="ts_available" class="numeric"></td>
            </tr>
            <tr>
               <td>In use</td>
               <td id="ts_inUse" class="numeric"></td>
            </tr>
            <tr>
               <td>Defective</td>
               <td id="ts_defective" class="numeric"></td>
            </tr>
            </tbody>
            <tfoot>
            <tr>
               <td colspan="4" class="numeric text-brand text-semibold">
                  Total: <span id="ts_total"></span>
               </td>
            </tr>
            </tfoot>
         </table>
      </div>
   </ui:define>
</ui:composition>
